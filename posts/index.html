<!doctype html><html lang=en-us><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge,chrome=1"><title>(Dev)Ops observations</title><meta name=viewport content="width=device-width,minimum-scale=1"><meta name=description content><meta name=generator content="Hugo 0.80.0"><meta name=ROBOTS content="NOINDEX, NOFOLLOW"><link rel=stylesheet href=/ananke/dist/main.css_5c99d70a7725bacd4c701e995b969fea.css><link href=/posts/index.xml rel=alternate type=application/rss+xml title="(Dev)Ops observations"><link href=/posts/index.xml rel=feed type=application/rss+xml title="(Dev)Ops observations"><meta property="og:title" content="Posts"><meta property="og:description" content><meta property="og:type" content="website"><meta property="og:url" content="http://blog.ylitalot.com/posts/"><meta property="og:updated_time" content="2019-01-05T12:00:00+02:00"><meta itemprop=name content="Posts"><meta itemprop=description content><meta name=twitter:card content="summary"><meta name=twitter:title content="Posts"><meta name=twitter:description content></head><body class="ma0 avenir bg-near-white"><header><div class="pb3-m pb6-l bg-black"><nav class="pv3 ph3 ph4-ns" role=navigation><div class="flex-l justify-between items-center center"><a href=/ class="f3 fw2 hover-white no-underline white-90 dib">(Dev)Ops observations</a><div class="flex-l items-center"><a href=https://twitter.com/jylitalo target=_blank class="link-transition twitter link dib z-999 pt3 pt0-l mr1" title="Twitter link" rel=noopener aria-label="follow on Twitter——Opens in a new window"><svg height="32" style="enable-background:new 0 0 67 67" viewBox="0 0 67 67" width="32" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M37.167 22.283c-2.619.953-4.274 3.411-4.086 6.101l.063 1.038-1.048-.127c-3.813-.487-7.145-2.139-9.974-4.915l-1.383-1.377-.356 1.017c-.754 2.267-.272 4.661 1.299 6.271.838.89.649 1.017-.796.487-.503-.169-.943-.296-.985-.233-.146.149.356 2.076.754 2.839.545 1.06 1.655 2.097 2.871 2.712l1.027.487-1.215.021c-1.173.0-1.215.021-1.089.467.419 1.377 2.074 2.839 3.918 3.475l1.299.444-1.131.678c-1.676.976-3.646 1.526-5.616 1.568C19.775 43.256 19 43.341 19 43.405c0 .211 2.557 1.397 4.044 1.864 4.463 1.377 9.765.783 13.746-1.568 2.829-1.673 5.657-5 6.978-8.221.713-1.716 1.425-4.851 1.425-6.354.0-.975.063-1.102 1.236-2.267.692-.678 1.341-1.419 1.467-1.631.21-.403.188-.403-.88-.043-1.781.636-2.033.551-1.152-.402.649-.678 1.425-1.907 1.425-2.267.0-.063-.314.042-.671.233-.377.212-1.215.53-1.844.72l-1.131.361-1.027-.7c-.566-.381-1.361-.805-1.781-.932C39.766 21.902 38.131 21.944 37.167 22.283zM33 64C16.432 64 3 50.569 3 34S16.432 4 33 4s30 13.431 30 30S49.568 64 33 64z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg><span class=new-window><svg height="8" style="enable-background:new 0 0 1000 1000" viewBox="0 0 1e3 1e3" width="8" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M598 128h298v298h-86V274L392 692l-60-60 418-418H598v-86zM810 810V512h86v298c0 46-40 86-86 86H214c-48 0-86-40-86-86V214c0-46 38-86 86-86h298v86H214v596h596z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg></span></a></div></div></nav><div class="tc-l pv3 ph3 ph4-ns"><h1 class="f2 f-subheadline-l fw2 light-silver mb0 lh-title">Posts</h1></div></div></header><main class=pb7 role=main><article class="pa3 pa4-ns nested-copy-line-height nested-img"><section class="cf ph3 ph5-l pv3 pv4-l f4 tc-l center measure-wide lh-copy mid-gray"></section><section class="flex-ns flex-wrap justify-around mt5"><div class="relative w-100 w-30-l mb4 bg-white"><div class="relative w-100 mb4 bg-white nested-copy-line-height"><div class="bg-white mb3 pa4 gray overflow-hidden"><span class="f6 db">Posts</span><h1 class="f3 near-black"><a href=http://blog.ylitalot.com/posts/github-pages/ class="link black dim">Github Pages</a></h1><div class="nested-links f5 lh-copy nested-copy-line-height">Current solution is based on Hugo and its instructions for Hosting on Github with GitHub Actions.</div></div></div></div><div class="relative w-100 w-30-l mb4 bg-white"><div class="relative w-100 mb4 bg-white nested-copy-line-height"><div class="bg-white mb3 pa4 gray overflow-hidden"><span class="f6 db">Posts</span><h1 class="f3 near-black"><a href=http://blog.ylitalot.com/posts/linters/ class="link black dim">Linters</a></h1><div class="nested-links f5 lh-copy nested-copy-line-height">Linter is any tool that detects and flags errors in programming languages, including stylistic errors. - Wikipedia
My favorite linters for various tasks:
Ansible: ansible-lint Golang: golangci-lint JavaScript: prettier-standard Puppet: puppet-lint Python: pylint Ruby: rubocop Terraform: terraform fmt Changelog 2021-Feb-21: Added golangci-lint</div></div></div></div><div class="relative w-100 w-30-l mb4 bg-white"><div class="relative w-100 mb4 bg-white nested-copy-line-height"><div class="bg-white mb3 pa4 gray overflow-hidden"><span class="f6 db">Posts</span><h1 class="f3 near-black"><a href=http://blog.ylitalot.com/posts/ansible-notes/ class="link black dim">Notes about Ansible</a></h1><div class="nested-links f5 lh-copy nested-copy-line-height">My favorite Ansible tools and personal contributions towards Ansible.
Profiling Ansible Create ansible.cfg file into same directory with playbook with following content:
[default] callback_whitelist = profile_tasks Source: ansible-profile
Related tools ansible-lint Related tools Personal opinions, contributions, etc. My personal background with configuration management tools starts from Cfengine in &rsquo;90s that we used to customize Linux installations. Followed by Puppet to setup multi-node installations in &rsquo;00s. In &lsquo;16, I came across with Chef, but my current choice for configuration tasks is Ansible, even if it is not the fastest tool on a market.</div></div></div></div><div class="relative w-100 w-30-l mb4 bg-white"><div class="relative w-100 mb4 bg-white nested-copy-line-height"><div class="bg-white mb3 pa4 gray overflow-hidden"><span class="f6 db">Posts</span><h1 class="f3 near-black"><a href=http://blog.ylitalot.com/posts/ssh-notes/ class="link black dim">Notes about SSH</a></h1><div class="nested-links f5 lh-copy nested-copy-line-height">Random notes about ssh config and related topics.
Making hostnames easier Openssh reads your ~/.ssh/config/ before it checks what IP address it should use for connection. This allows you to do things like:
Host bastion.company Hostname 10.10.10.5 IdentityFile ~/.ssh/company.pem ForwardAgent yes User ec2-user or if you wish to by pass bastion:
Host _final_destination_ User _at_bastion_ ProxyCommand ssh _bastion_host_ netcat %h %p So even if the hostname is not in a DNS or it has some strange name like ec2-10-10-10-5.</div></div></div></div><div class="relative w-100 w-30-l mb4 bg-white"><div class="relative w-100 mb4 bg-white nested-copy-line-height"><div class="bg-white mb3 pa4 gray overflow-hidden"><span class="f6 db">Posts</span><h1 class="f3 near-black"><a href=http://blog.ylitalot.com/posts/chef-without-server/ class="link black dim">Chef without Chef server</a></h1><div class="nested-links f5 lh-copy nested-copy-line-height">There are couple alternatives available if you wish to use Chef in your infrastructure, but don&rsquo;t have budget to setup hosted Chef service. So far I&rsquo;ve seen one based on Git and another based on AWS S3.
Git based solution In git based solution, create repository into bitbucket.com and create directory tree:
/chef/cookbooks/my_cookbook/definitions/default.rb /chef/cookbooks/my_cookbook/files /chef/cookbooks/my_cookbook/recipes/default.rb In your /chef/cookbooks/my_cookbook/recipes/default.rb, put following text among other stuff:
directory '/root/bin' do owner 'root' group 'root' mode '0700' action :create end cookbook_file '/root/bin/run_chef' do source 'run_chef' owner 'root' group 'root' mode '0700' action :create end cron 'run chef hourly' do minute '13' user 'root' home '/root' command '/root/bin/run_chef' action :create end Create /chef/cookbooks/my_cookbook/files/run_chef:</div></div></div></div><div class="relative w-100 w-30-l mb4 bg-white"><div class="relative w-100 mb4 bg-white nested-copy-line-height"><div class="bg-white mb3 pa4 gray overflow-hidden"><span class="f6 db">Posts</span><h1 class="f3 near-black"><a href=http://blog.ylitalot.com/posts/python-doctest/ class="link black dim">Doctest in Python</a></h1><div class="nested-links f5 lh-copy nested-copy-line-height">My Assets on Octopress script needed couple modifications and I felt that it was good platform for doing unit tests. Python has nice test framework called doctest, which allows you to insert unit test cases as comments in your python code. My current tests are done for methods that don&rsquo;t recover mockups (for things like file system access) and simply return strings, lists and such to caller.
In following example, I have method called _extract_from_markdown, which gets one line of text from markdown file as string.</div></div></div></div><div class="relative w-100 w-30-l mb4 bg-white"><div class="relative w-100 mb4 bg-white nested-copy-line-height"><div class="bg-white mb3 pa4 gray overflow-hidden"><span class="f6 db">Posts</span><h1 class="f3 near-black"><a href=http://blog.ylitalot.com/posts/chef-notes/ class="link black dim">Notes about Chef</a></h1><div class="nested-links f5 lh-copy nested-copy-line-height">Random notes about chef configuration management tool and related topics.
Problem with knife bootstrap:
[root@localhost chef-repo]# knife bootstrap --run-list "role[phpapp]" --json-attributes "{\"phpapp\": {\"server_name\": \"localhost.localdomain\"}}" --ssh-user root --ssh-password PASSWORD HOSTNAME&lt;br/> Node&amp;nbsp;&amp;nbsp;exists, overwrite it? (Y/N) y&lt;br/> &lt;span style="color: red">ERROR:&lt;/span> Method Not Allowed&lt;br/> Response: &amp;lt;html&amp;gt;&amp;lt;head>&amp;lt;title&amp;gt;405 Method Not Allowed&amp;lt;/title&amp;gt;&amp;lt;/head&amp;gt;&amp;lt;body&amp;gt;&amp;lt;h1&amp;gt;Method Not Allowed&amp;lt;/h1&amp;gt;Method Not Allowed&amp;lt;p&amp;gt;&amp;lt;hr&amp;gt;&amp;lt;address&amp;gt;mochiweb+webmachine web server&amp;lt;/address&amp;gt;&amp;lt;/body&amp;gt;&amp;lt;/html&amp;gt; [root@localhost chef-repo]# Solution:
[root@localhost chef-repo]# knife bootstrap &lt;b>--node-name NODENAME&lt;/b> --run-list "role[phpapp]" --json-attributes "{\"phpapp\": {\"server_name\": \"localhost.localdomain\"}}" --ssh-user root --ssh-password PASSWORD HOSTNAME&lt;br/> .</div></div></div></div><div class="relative w-100 w-30-l mb4 bg-white"><div class="relative w-100 mb4 bg-white nested-copy-line-height"><div class="bg-white mb3 pa4 gray overflow-hidden"><span class="f6 db">Posts</span><h1 class="f3 near-black"><a href=http://blog.ylitalot.com/posts/iptables-notes/ class="link black dim">Notes about IPTables</a></h1><div class="nested-links f5 lh-copy nested-copy-line-height">Random notes about iptables, ufw and such tools in Linux.
Your /etc/sysconfig/iptables should have following lines:
If you are forwarding TCP connections from NAT instance to some instance that doesn&rsquo;t have public IP, you can easily add logging into iptables. Log entries will appear in /var/log/messages.
Lines in /var/log/messages:</div></div></div></div><div class="relative w-100 w-30-l mb4 bg-white"><div class="relative w-100 mb4 bg-white nested-copy-line-height"><div class="bg-white mb3 pa4 gray overflow-hidden"><span class="f6 db">Posts</span><h1 class="f3 near-black"><a href=http://blog.ylitalot.com/posts/puppet-notes/ class="link black dim">Notes about Puppet</a></h1><div class="nested-links f5 lh-copy nested-copy-line-height">Random notes about puppet configuration management tool and related topics.
Puppet doesn&rsquo;t like symlinks
When you start building /etc/puppet/environments/production in your puppet master, don&rsquo;t use symlinks on directory tree. I once made the mistake of using symlinks for manifests and modules directories and was getting frustrated, when puppet agent didn&rsquo;t seem to get my manifests/site.pp file.
Once I copied all the directly into /etc/puppet/environments/production tree, things started to work.
Use info(), notice() or debug() in site.</div></div></div></div><div class="relative w-100 w-30-l mb4 bg-white"><div class="relative w-100 mb4 bg-white nested-copy-line-height"><div class="bg-white mb3 pa4 gray overflow-hidden"><span class="f6 db">Posts</span><h1 class="f3 near-black"><a href=http://blog.ylitalot.com/posts/virtualbotes-notes/ class="link black dim">VirtualBox notes</a></h1><div class="nested-links f5 lh-copy nested-copy-line-height">Random notes about VirtualBox and related topics.
Problem:
Virtual machines clock keeps on drifting so much that time difference between your VM and Amazon EC2 will go out of thresholds. Once you are beyond threshold limits, EC2 will refuse all commands that require authentication.
You can check this in host OS with:# VBoxManage list vms # for VM in ... # do # VBoxManage guestproperty get VM --timesync-set-threshold # done &lt;b>No value set!</div></div></div></div></section></article></main><footer class="bg-black bottom-0 w-100 pa3" role=contentinfo><div class="flex justify-between"><a class="f4 fw4 hover-white no-underline white-70 dn dib-ns pv2 ph3" href=http://blog.ylitalot.com/>&copy; Juha Ylitalo &lt;juha@ylitalot.net> 2021</a><div><a href=https://twitter.com/jylitalo target=_blank class="link-transition twitter link dib z-999 pt3 pt0-l mr1" title="Twitter link" rel=noopener aria-label="follow on Twitter——Opens in a new window"><svg height="32" style="enable-background:new 0 0 67 67" viewBox="0 0 67 67" width="32" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M37.167 22.283c-2.619.953-4.274 3.411-4.086 6.101l.063 1.038-1.048-.127c-3.813-.487-7.145-2.139-9.974-4.915l-1.383-1.377-.356 1.017c-.754 2.267-.272 4.661 1.299 6.271.838.89.649 1.017-.796.487-.503-.169-.943-.296-.985-.233-.146.149.356 2.076.754 2.839.545 1.06 1.655 2.097 2.871 2.712l1.027.487-1.215.021c-1.173.0-1.215.021-1.089.467.419 1.377 2.074 2.839 3.918 3.475l1.299.444-1.131.678c-1.676.976-3.646 1.526-5.616 1.568C19.775 43.256 19 43.341 19 43.405c0 .211 2.557 1.397 4.044 1.864 4.463 1.377 9.765.783 13.746-1.568 2.829-1.673 5.657-5 6.978-8.221.713-1.716 1.425-4.851 1.425-6.354.0-.975.063-1.102 1.236-2.267.692-.678 1.341-1.419 1.467-1.631.21-.403.188-.403-.88-.043-1.781.636-2.033.551-1.152-.402.649-.678 1.425-1.907 1.425-2.267.0-.063-.314.042-.671.233-.377.212-1.215.53-1.844.72l-1.131.361-1.027-.7c-.566-.381-1.361-.805-1.781-.932C39.766 21.902 38.131 21.944 37.167 22.283zM33 64C16.432 64 3 50.569 3 34S16.432 4 33 4s30 13.431 30 30S49.568 64 33 64z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg><span class=new-window><svg height="8" style="enable-background:new 0 0 1000 1000" viewBox="0 0 1e3 1e3" width="8" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M598 128h298v298h-86V274L392 692l-60-60 418-418H598v-86zM810 810V512h86v298c0 46-40 86-86 86H214c-48 0-86-40-86-86V214c0-46 38-86 86-86h298v86H214v596h596z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg></span></a></div></div></footer></body></html>